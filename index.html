<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Lottie Loader — drag & resize + bg</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color-scheme: dark; }
    body { margin:0; background:#0b0f14; color:#e8eef5; display:flex; flex-direction:column; min-height:100vh; align-items:center; }
    .header { width:100%; padding:12px 16px; border-bottom:1px solid #223044; background:#0e1420; }
    .title { font-weight:600; text-align:center; }
    .panel { width:100%; padding:20px; box-sizing:border-box; display:flex; flex-direction:column; align-items:center; }

    .controls { margin-bottom:16px; display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:center; }
    input[type="file"] { display:none; }
    .btn, select, input[type="text"], input[type="color"], input[type="range"], label.switch {
      border:1px solid #2a3b55; background:#172335; color:#e8eef5; border-radius:8px; padding:8px 10px; font-size:14px;
    }
    .btn { cursor:pointer; }
    .hint { font-size:13px; color:#9fb0c7; text-align:center; }
    .row { display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
    .switch { display:inline-flex; align-items:center; gap:8px; padding:6px 8px; background:#101725; border:1px solid #2a3b55; border-radius:8px; }
    .switch input { appearance:none; width:40px; height:22px; background:#213048; border-radius:999px; position:relative; outline:none; cursor:pointer; }
    .switch input:checked { background:#3a6cf0; }
    .switch input::after { content:""; position:absolute; top:3px; left:3px; width:16px; height:16px; border-radius:50%; background:#e8eef5; transition:left .2s; }
    .switch input:checked::after { left:21px; }

    /* Stage */
    #f1-stage {
      position: relative;
      background:#0f141c; border:1px dashed #2a3b55; border-radius:12px; overflow:hidden;
      margin:0 auto; display:flex; align-items:center; justify-content:center;
      box-sizing:border-box; padding:32px; /* внутренние 32px */
      width:100%; max-width:1440px; aspect-ratio:16/9;
      cursor:default;
    }
    @media (max-width:768px){ #f1-stage{ max-width:375px; aspect-ratio:9/16; } }
    #f1-stage:hover { border-color:#3a6cf0; }

    /* Рабочая зона (границы для перетаскивания/ресайза) */
    .canvas-area { position:absolute; inset:32px; }

    /* Фон */
    #bgImg {
      position:absolute; inset:32px;
      object-fit:contain; opacity:1; pointer-events:none; user-select:none; border-radius:8px;
      z-index:0; display:none;
    }

    /* Lottie Host (рамка с ручками) */
    #lottieHost {
      position:absolute;
      left:32px; top:32px; width:220px; height:220px;
      outline:1.5px dashed rgba(255,255,255,.4);
      border-radius:4px; z-index:1; box-sizing:border-box;
      touch-action:none; cursor:move; display:none; background:transparent;
    }
    #lottieMount { position:absolute; inset:0; }
    .handle{ position:absolute; width:12px; height:12px; background:#e8eef5; border:1px solid #1a273a; border-radius:2px; z-index:2; }
    .handle.nw{ left:-7px; top:-7px; cursor:nwse-resize; }
    .handle.ne{ right:-7px; top:-7px; cursor:nesw-resize; }
    .handle.sw{ left:-7px; bottom:-7px; cursor:nesw-resize; }
    .handle.se{ right:-7px; bottom:-7px; cursor:nwse-resize; }
    .handle.n{ left:50%; transform:translateX(-50%); top:-7px; cursor:ns-resize; }
    .handle.s{ left:50%; transform
