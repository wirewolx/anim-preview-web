<!-- ФИКС: перетаскивание Lottie без стартового сдвига -->
<script>
(function dragLottieNoJump(){
  const host = document.getElementById('f2-animHost');
  const content = document.getElementById('f2-content');
  if (!host || !content) return;

  // гарантия: нативные жесты не мешают
  host.style.touchAction = 'none';
  host.style.userSelect = 'none';
  host.style.cursor = 'move';

  let dragging = false;
  let grabX = 0, grabY = 0;

  // получить текущие left/top (в px) из стилей или из геометрии,
  // и если в стилях не задано — один раз выставить их как есть (БЕЗ округления!)
  function ensureCssLT() {
    const cs = getComputedStyle(host);
    let left = parseFloat(cs.left);
    let top  = parseFloat(cs.top);

    const cr = content.getBoundingClientRect();
    const hr = host.getBoundingClientRect();

    if (Number.isNaN(left)) left = hr.left - cr.left;
    if (Number.isNaN(top))  top  = hr.top  - cr.top;

    host.style.left = left + 'px';
    host.style.top  = top  + 'px';
    return { left, top };
  }

  host.addEventListener('pointerdown', (e) => {
    dragging = true;
    host.setPointerCapture(e.pointerId);

    // фиксируем фактические left/top в стилях
    const { left, top } = ensureCssLT();

    // считаем, за какое место внутри хоста схватили:
    // курсор минус левый верх хоста (в координатах контента)
    const cr = content.getBoundingClientRect();
    grabX = e.clientX - (cr.left + left);
    grabY = e.clientY - (cr.top  + top);

    e.preventDefault();
  });

  window.addEventListener('pointermove', (e) => {
    if (!dragging) return;

    const cr = content.getBoundingClientRect();

    // ставим так, чтобы точка захвата оставалась под курсором
    let newLeft = e.clientX - cr.left - grabX;
    let newTop  = e.clientY - cr.top  - grabY;

    // клампы в пределах изображения
    const maxLeft = content.clientWidth  - host.offsetWidth;
    const maxTop  = content.clientHeight - host.offsetHeight;

    if (maxLeft >= 0) newLeft = Math.max(0, Math.min(newLeft, maxLeft));
    if (maxTop  >= 0) newTop  = Math.max(0, Math.min(newTop,  maxTop));

    // без округления — убираем стартовый «пинок» на 0.5–1px
    host.style.left = newLeft + 'px';
    host.style.top  = newTop  + 'px';
  });

  window.addEventListener('pointerup', (e) => {
    if (!dragging) return;
    dragging = false;
    try { host.releasePointerCapture(e.pointerId); } catch {}
  });

  // Если показываешь хост динамически (display:none -> block),
  // вызови ensureCssLT() сразу после того, как сделал его видимым.
})();
</script>
