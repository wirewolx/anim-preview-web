<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Lottie — Loader + Screen Preview</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./styles/main.css" />
  <!-- Lottie глобально -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
</head>
<body>
  <nav class="tabs" role="tablist">
    <button class="tab-btn" id="tab-f1" aria-selected="true">Lottie Loader</button>
    <button class="tab-btn" id="tab-f2" aria-selected="false">Screen Preview 1440×800</button>
  </nav>

  <!-- Panel 1 -->
  <section id="panel-f1" class="panel active" role="tabpanel" aria-labelledby="tab-f1">
    <div class="controls">
      <label class="btn" for="f1-file">Выбрать JSON</label>
      <input id="f1-file" type="file" accept=".json,application/json" />

      <select id="f1-sizeSelect">
        <option value="120">120×120</option>
        <option value="160">160×160</option>
        <option value="180">180×180</option>
        <option value="200">200×200</option>
        <option value="220" selected>220×220</option>
      </select>

      <div class="row">
        <input type="color" id="f1-colorPicker" value="#0f141c" />
        <input type="text" id="f1-colorInput" value="#0f141c" maxlength="7" placeholder="#rrggbb" />
      </div>

      <label class="switch"><span>Loop</span><input type="checkbox" id="f1-loopToggle" checked /></label>

      <button class="btn" id="f1-startBtn" disabled>Start</button>
      <button class="btn" id="f1-stopBtn" disabled>Stop</button>
    </div>

    <div id="f1-stage" title="Кликните, чтобы загрузить Lottie" tabindex="0">
      <span id="f1-stage-hint" class="hint">Кликните сюда или выберите JSON сверху</span>
    </div>
    <p class="hint" id="f1-status">Файл не загружен</p>
  </section>

  <!-- Panel 2 -->
  <section id="panel-f2" class="panel" role="tabpanel" aria-labelledby="tab-f2">
    <div class="controls">
      <label class="btn" for="f2-imgFile">Загрузить скрин</label>
      <input id="f2-imgFile" type="file" accept="image/png,image/jpeg,image/webp" />
      <label class="btn" for="f2-jsonFile">Загрузить Lottie JSON</label>
      <input id="f2-jsonFile" type="file" accept=".json,application/json" />

      <button class="btn" id="f2-startBtn" disabled>Start</button>
      <button class="btn" id="f2-stopBtn" disabled>Stop</button>
      <label class="switch"><span>Loop</span><input type="checkbox" id="f2-loopToggle" checked /></label>
      <span class="hint">Непрозр.:</span>
      <input id="f2-opacityRange" type="range" min="0" max="100" value="100" />
    </div>

    <!-- contenteditable + tabindex, чтобы ловить Ctrl/Cmd+V -->
    <div class="stage-frame" id="f2-stage" contenteditable="true" tabindex="0" aria-label="Screen Preview area">
      <img id="f2-bgImg" alt="Скрин" />
      <div id="f2-animHost">
        <div class="handle nw"></div>
        <div class="handle ne"></div>
        <div class="handle sw"></div>
        <div class="handle se"></div>
      </div>
    </div>
    <p class="hint" id="f2-status">Размер экрана: 1440×800. Кликните по области, затем вставьте скрин (Ctrl/Cmd+V). В Figma используйте Copy as PNG.</p>
  </section>

  <!-- Скрипты (обычные теги, без модулей) -->
  <script src="./scripts/helpers.js"></script>
  <script src="./scripts/tabs.js"></script>
  <script src="./scripts/loader.js"></script>
  <script src="./scripts/preview.js"></script>
  <script src="./scripts/main.js"></script>

  <!-- Вставка изображения из буфера обмена по Ctrl/Cmd+V (оригинальный размер) -->
  <script>
    (function enablePasteToStage(){
      const stage  = document.getElementById('f2-stage');
      const bg     = document.getElementById('f2-bgImg');
      const status = document.getElementById('f2-status');
      if (!stage || !bg) return;

      // Фокус при клике — чтобы Ctrl/Cmd+V пришёл в нужную область
      stage.addEventListener('click', () => { stage.focus(); });

      function setHint(msg){ if (status) status.textContent = msg; }

      stage.addEventListener('paste', handlePaste);
      document.addEventListener('paste', handlePaste);

      function setImage(src, fileName) {
       bg.onload = () => {
    // когда картинка загрузилась, подгоняем контейнер
        stage.style.width = bg.naturalWidth + 'px';
        stage.style.height = bg.naturalHeight + 'px';
        };
        bg.src = src;
        bg.style.display = 'block';
        bg.style.width = 'auto';
        bg.style.height = 'auto';
        setHint('Скрин вставлен' + (fileName ? ': ' + fileName : ''));
      }

      async function handlePaste(e){
        try {
          const cd = e.clipboardData;
          if (!cd) return;

          // 1) Файл-изображение (PNG/JPEG/WebP)
          const item = [...cd.items].find(i => i.type && i.type.startsWith('image/'));
          if (item) {
            const file = item.getAsFile();
            if (file) {
              const url = URL.createObjectURL(file);
              setImage(url, file.name);
              e.preventDefault();
              return;
            }
          }

          // 2) Data URL (data:image/...)
          const txt = cd.getData('text/plain');
          if (txt && txt.startsWith('data:image/')) {
            setImage(txt);
            e.preventDefault();
            return;
          }

          // 3) HTML с <img src="...">
          const html = cd.getData('text/html');
          if (html) {
            const wrap = document.createElement('div');
            wrap.innerHTML = html;
            const img = wrap.querySelector('img');
            if (img && img.src) {
              setImage(img.src);
              e.preventDefault();
              return;
            }
          }

          setHint('В буфере нет картинки. Скопируйте фрейм как PNG из Figma (Copy as PNG), затем Ctrl/Cmd+V здесь.');
        } catch (err) {
          console.error('Paste error:', err);
          setHint('Не удалось вставить изображение.');
        }
      }
    })();
  </script>
</body>
</html>

